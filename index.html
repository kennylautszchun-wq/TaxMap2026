<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨…å‹™åœ°åœ– - 2025/26 å¹´åº¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', "Microsoft JhengHei", sans-serif;
            background-color: #f3f4f6;
        }
        .card-bg {
            background-color: #1a1a1a;
            position: relative;
            overflow: hidden;
        }
        .map-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(to right, rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .accent-orange {
            color: #ff6b00;
        }
        .bg-accent-orange {
            background-color: #ff6b00;
        }
        .accent-blue {
            color: #3b82f6;
        }
        .bg-accent-blue {
            background-color: #3b82f6;
        }
        .text-gray-custom {
            color: #a1a1aa;
        }
        .border-gray-custom {
            border-color: #333;
        }
        input::placeholder {
            color: #4b5563;
        }
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ff6b00'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
        .page-transition {
            transition: all 0.4s ease-in-out;
        }
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 10px;
        }
        @keyframes pulse-blue {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pin {
            animation: pulse-blue 2s infinite ease-in-out;
        }
        .new-badge {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            margin-left: 8px;
        }
        /* éš±è—åŸç”Ÿ details çš„ç®­é ­ */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div id="app" class="relative w-full mx-auto" style="max-width: 500px;">
        
        <!-- Page Control -->
        <div class="flex justify-between mb-4">
            <button onclick="prevPage()" id="prev-btn" class="text-sm font-bold tracking-tighter hover:text-orange-500 transition-colors opacity-0 pointer-events-none">â† PREVIOUS</button>
            <button onclick="nextPage()" id="next-btn" class="text-sm font-bold tracking-tighter hover:text-orange-500 transition-colors">NEXT CHAPTER â†’</button>
        </div>

        <!-- Card Container -->
        <div class="card-bg text-white rounded-sm shadow-2xl overflow-hidden page-transition border border-white/10">
            
            <!-- Map Grid Effect -->
            <div id="grid-bg" class="map-grid"></div>

            <!-- Top Accent Bar -->
            <div class="h-1.5 w-full bg-gray-800 flex relative z-10">
                <div id="progress-bar" class="h-full bg-accent-orange transition-all duration-500" style="width: 20%;"></div>
            </div>

            <!-- Card Content -->
            <div class="p-8 md:p-12 min-h-[680px] flex flex-col justify-between relative z-10">
                
                <div id="content-area">
                    <!-- Page 01: Cover -->
                    <div id="page-01" class="block">
                        <header class="mt-12 relative">
                            <p class="text-xs font-black italic accent-orange tracking-[0.5em] mb-4">2025/26 èª²ç¨…å¹´åº¦</p>
                            
                            <div class="relative inline-block">
                                <h1 class="text-7xl font-black italic tracking-tighter leading-[0.8] uppercase relative z-10">
                                    TAX<br><span class="accent-orange">MAP.</span>
                                </h1>
                                <div class="absolute -right-12 top-0 animate-pin">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 21C16 17 20 13.4183 20 9C20 4.58172 16.4183 1 12 1C7.58172 1 4 4.58172 4 9C4 13.4183 8 17 12 21Z" fill="#3b82f6" stroke="white" stroke-width="1.5"/>
                                        <circle cx="12" cy="9" r="3" fill="white"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <h2 class="text-4xl font-black italic tracking-tighter mt-2 flex items-center gap-2">
                                ç¨…å‹™åœ°åœ–<span class="accent-orange">.</span>
                                <span class="new-badge">CURRENT</span>
                            </h2>

                            <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-blue-600/10 blur-[60px] rounded-full pointer-events-none"></div>
                            
                            <p class="mt-12 text-sm font-bold tracking-widest text-gray-custom uppercase border-l-2 border-orange-500 pl-4">
                                ç¾è¡Œå¹´åº¦å°èˆªï¼š<br>å…¨é¢æŒæ¡å…ç¨…é¡åŠæ‰£ç¨…æ”»ç•¥
                            </p>
                        </header>
                        <div class="mt-16">
                            <p class="text-[10px] font-black tracking-widest text-gray-600 uppercase">Scroll or Click Next to See Changes</p>
                        </div>
                    </div>

                    <!-- Page 02: Allowances -->
                    <div id="page-02" class="hidden text-left">
                        <header class="mb-8">
                            <p class="text-xs font-black italic accent-orange tracking-[0.3em] mb-2">02 / ALLOWANCES</p>
                            <h1 class="text-5xl font-black italic tracking-tighter">å…ç¨…é¡åœ°åœ–<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-6">
                            <div>
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">ç¾è¡Œå…ç¨…é¡ä¸€è¦½</p>
                                <div class="grid grid-cols-1 gap-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">åŸºæœ¬å…ç¨…é¡</span>
                                        <span class="text-lg font-black">$132,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">å­å¥³å…ç¨…é¡</span>
                                        <span class="text-lg font-black">$130,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">çˆ¶æ¯åŒä½ (60+)</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-8">
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">Deductions æ‰£é™¤é¡</p>
                                <div class="grid grid-cols-1 gap-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">å±…æ‰€è²¸æ¬¾ / ä½å®…ç§Ÿé‡‘æ‰£é™¤</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic text-gray-300">è‡ªé¡˜é†«ä¿ (VHIS)</span>
                                        <span class="text-lg font-black text-gray-300">$8,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic accent-orange">å¹´é‡‘ (QDAP) / TVC</span>
                                        <span class="text-lg font-black accent-orange">$60,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 03: PRO Calculator -->
                    <div id="page-03" class="hidden">
                        <header class="mb-4 flex justify-between items-end">
                            <div>
                                <p class="text-xs font-black italic accent-orange tracking-[0.3em] mb-1">03 / PRO ENGINE</p>
                                <h1 class="text-4xl font-black italic tracking-tighter">å°ˆæ¥­ç¨…å‹™è¨ˆç®—æ©Ÿ<span class="accent-orange">.</span></h1>
                            </div>
                        </header>
                        
                        <!-- è¨ˆç®—æ©Ÿä¸»é«”ï¼ŒåŠ å…¥æ»¾å‹•æ¢é©æ‡‰å¤šå€‹è¼¸å…¥ -->
                        <div class="space-y-3 max-h-[460px] overflow-y-auto pr-2 custom-scroll pb-4">
                            
                            <!-- 1. åŸºæœ¬è³‡æ–™ -->
                            <div class="p-3 bg-white/5 border border-gray-700 rounded-sm">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="col-span-2">
                                        <label class="text-[10px] font-bold text-gray-custom tracking-widest uppercase mb-1 block">Annual Income ç¸½å¹´è–ª/å…¥æ¯</label>
                                        <input type="number" id="income" placeholder="ä¾‹å¦‚: 600000" class="w-full bg-black/40 border border-gray-600 p-2 rounded-sm text-lg font-black focus:border-orange-500 transition-colors outline-none text-white">
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">å©šå§»ç‹€æ³</label>
                                        <select id="maritalStatus" class="w-full bg-black/40 border border-gray-600 p-2 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="single">å–®èº« / æœªå©š</option>
                                            <option value="married">å·²å©š (åˆä½µè¨ˆç®—)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">å–®è¦ªå…ç¨…é¡</label>
                                        <select id="singleParent" class="w-full bg-black/40 border border-gray-600 p-2 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="0">å¦</option>
                                            <option value="1">æ˜¯ (éœ€æ’«é¤Šå­å¥³)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. å®¶åº­æˆå“¡å…ç¨…é¡ (æ‘ºç–Šé¸å–®) -->
                            <details class="group bg-white/5 border border-gray-800 rounded-sm">
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-xs accent-orange uppercase tracking-widest outline-none">
                                    â–¼ é€²éšå…ç¨…é¡ (å­å¥³åŠçˆ¶æ¯)
                                    <span class="text-[10px] text-gray-500 group-open:hidden">é»æ“Šå±•é–‹</span>
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-3">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">å­å¥³æ•¸ç›® ($130k)</label>
                                            <input type="number" id="childCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">ä»Šå¹´å‡ºç”Ÿå¬°å…’ (é¡å¤–$130k)</label>
                                            <input type="number" id="newbornCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">çˆ¶æ¯ 60æ­²+ (åŒä½ $100k)</label>
                                            <input type="number" id="p60T" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">çˆ¶æ¯ 60æ­²+ (éåŒä½ $50k)</label>
                                            <input type="number" id="p60N" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">çˆ¶æ¯ 55-59æ­² (åŒä½ $50k)</label>
                                            <input type="number" id="p55T" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">çˆ¶æ¯ 55-59æ­² (éåŒä½ $25k)</label>
                                            <input type="number" id="p55N" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-1.5 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- 3. æ‰£é™¤é¡ (æ‘ºç–Šé¸å–®) -->
                            <details class="group bg-white/5 border border-gray-800 rounded-sm" open>
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-xs accent-orange uppercase tracking-widest outline-none">
                                    â–¼ æ‰£ç¨…é …ç›® (ä¿éšªã€æˆ¿å±‹ã€å¼·ç©é‡‘)
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-2">
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">å¼·ç©é‡‘ MPF (ä¸Šé™18k)</label>
                                        <input type="number" id="mpf" value="18000" class="w-28 bg-black/40 border border-gray-700 p-1 rounded-sm text-right font-bold text-sm focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">åˆè³‡æ ¼å»¶æœŸå¹´é‡‘ / TVC</label>
                                        <input type="number" id="qdap" placeholder="ä¸Šé™ 60k" class="w-28 bg-black/40 border border-gray-700 p-1 rounded-sm text-right font-bold text-sm focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">è‡ªé¡˜é†«ä¿ VHIS (ç¸½ä¿è²»)</label>
                                        <input type="number" id="vhis" placeholder="æ¯åè¦ªå±¬ä¸Šé™ 8k" class="w-28 bg-black/40 border border-gray-700 p-1 rounded-sm text-right font-bold text-sm focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">ä½å®…ç§Ÿé‡‘ / æ¨“å®‡æŒ‰æ­åˆ©æ¯</label>
                                        <input type="number" id="housing" placeholder="ä¸Šé™ 100k" class="w-28 bg-black/40 border border-gray-700 p-1 rounded-sm text-right font-bold text-sm focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">å€‹äººé€²ä¿®é–‹æ”¯</label>
                                        <input type="number" id="education" placeholder="ä¸Šé™ 100k" class="w-28 bg-black/40 border border-gray-700 p-1 rounded-sm text-right font-bold text-sm focus:border-orange-500 outline-none">
                                    </div>
                                </div>
                            </details>

                            <!-- è¨ˆç®—æŒ‰éˆ• -->
                            <button onclick="calculateProTax()" class="w-full bg-accent-orange py-3 mt-2 font-black italic text-lg hover:bg-orange-600 transition-all uppercase tracking-tighter shadow-lg shadow-orange-500/20">é–‹å§‹å°ˆæ¥­é‹ç®—</button>
                            
                            <!-- çµæœå±•ç¤º -->
                            <div id="result-box" class="mt-4 p-4 bg-gradient-to-br from-white/10 to-transparent border border-orange-500/40 rounded-sm hidden animate-pulse relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-2 opacity-10">
                                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                                </div>
                                
                                <p class="text-[10px] font-bold text-gray-300 tracking-widest uppercase mb-1">Final Tax Payable æ‡‰ç¹³ç¨…æ¬¾ç¸½é¡</p>
                                <p id="tax-result" class="text-5xl font-black accent-orange italic drop-shadow-md">$0</p>
                                
                                <div class="mt-4 grid grid-cols-2 gap-3 border-t border-gray-700 pt-3">
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">ç¸½å…ç¨…é¡</p>
                                        <p id="total-allowance-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">ç¸½æ‰£é™¤é¡</p>
                                        <p id="total-deduction-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                    <div class="col-span-2">
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">æ‡‰èª²ç¨…å…¥æ¯å¯¦é¡ (Net Chargeable Income)</p>
                                        <p id="nci-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                </div>
                                <div class="mt-3 bg-blue-900/30 border border-blue-500/30 p-2 rounded text-[9px] text-blue-200 flex items-center justify-between">
                                    <span id="tax-method" class="font-bold">æ¡ç”¨ç´¯é€²ç¨…ç‡è¨ˆç®—</span>
                                    <span class="italic">å·²æ‰£æ¸› $3,000 å¯¬å…é¡</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 04: Call to Action -->
                    <div id="page-04" class="hidden">
                        <header class="mb-6">
                            <p class="text-xs font-black italic accent-orange tracking-[0.3em] mb-2">04 / THE DESTINATION</p>
                            <h1 class="text-5xl font-black italic tracking-tighter leading-tight">é ˜å–æ‡¶äººåŒ…<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-6">
                            <div class="bg-accent-blue/10 p-4 border-l-4 border-accent-blue rounded-sm">
                                <p class="text-sm font-bold italic text-white mb-2 underline decoration-blue-500 underline-offset-4">2025/26 æ‰£ç¨…æ‡¶äººåŒ…</p>
                                <p class="text-xs text-gray-300 leading-relaxed">
                                    æƒ³çŸ¥é“å¦‚ä½•å–„ç”¨å„é …æ‰£ç¨…é¡ï¼ˆå¦‚åˆè³‡æ ¼å»¶æœŸå¹´é‡‘ QDAPã€è‡ªé¡˜é†«ä¿ VHIS ç­‰ï¼‰ï¼Ÿç•™ä¸‹ WhatsAppï¼Œç³»çµ±æœƒå³æ™‚ç™¼é€ã€Œ2025/26 æ‰£ç¨…æ‡¶äººåŒ…ã€çµ¦ä½ åƒè€ƒï¼ŒåŠ©ä½ è¼•é¬†äº†è§£å„é …æ‰£ç¨…ç´°ç¯€ï¼
                                </p>
                            </div>

                            <div class="space-y-3 mt-8">
                                <div class="relative">
                                    <input type="text" id="cta-name" placeholder="ä½ çš„å§“å / Name" class="w-full bg-white/5 border border-gray-700 p-3 rounded-sm text-sm font-bold focus:border-blue-500 outline-none transition-all">
                                </div>
                                <div class="relative">
                                    <input type="tel" id="cta-phone" placeholder="WhatsApp è™Ÿç¢¼ (ä¾‹: 91234567)" class="w-full bg-white/5 border border-gray-700 p-3 rounded-sm text-sm font-bold focus:border-green-500 outline-none transition-all">
                                </div>
                                
                                <button onclick="handleExcelRequest()" id="cta-btn" class="w-full bg-accent-blue py-4 mt-2 font-black italic text-lg hover:bg-blue-600 transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] uppercase tracking-tighter flex items-center justify-center gap-3">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                    ç«‹åˆ»é ˜å–æ‡¶äººåŒ…
                                </button>
                                
                                <p class="text-[9px] text-center text-gray-500 uppercase tracking-widest mt-4 italic leading-relaxed">
                                    * æ‚¨çš„è³‡æ–™çµ•å°ä¿å¯†ï¼Œåƒ…ç”¨æ–¼ç™¼é€æ‡¶äººåŒ…åŠç›¸é—œè³‡è¨Šã€‚<br>æœ¬äººç‚ºç†è²¡é¡§å•ï¼Œæœ¬å°ˆé å…§å®¹çµ•ä¸æ§‹æˆå°ˆæ¥­ç¨…å‹™å»ºè­°ã€‚
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="mt-8 pt-8 border-t border-gray-custom flex justify-between items-center bg-white/5 -mx-8 -mb-8 p-8 md:-mx-12 md:-mb-12 md:p-12">
                    <div>
                        <p class="text-[10px] font-black tracking-[0.2em] italic uppercase">Tax Map 2025/26</p>
                        <p class="text-[10px] font-bold text-gray-custom tracking-widest uppercase">Authored by Klau</p>
                    </div>
                    <div class="text-3xl font-black italic" id="page-number">01</div>
                </footer>

            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const totalPages = 4;

        function updateUI() {
            for (let i = 1; i <= totalPages; i++) {
                document.getElementById(`page-0${i}`).classList.add('hidden');
            }
            document.getElementById(`page-0${currentPage}`).classList.remove('hidden');
            document.getElementById('page-number').innerText = `0${currentPage}`;
            
            document.getElementById('grid-bg').style.opacity = (currentPage === 1 || currentPage === 5) ? '1' : '0.3';

            const progress = (currentPage / totalPages) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            if (currentPage === 1) {
                prevBtn.classList.add('opacity-0', 'pointer-events-none');
            } else {
                prevBtn.classList.remove('opacity-0', 'pointer-events-none');
            }

            if (currentPage === totalPages) {
                nextBtn.innerText = 'GO TO START';
                nextBtn.classList.add('accent-blue');
                nextBtn.classList.remove('accent-orange');
            } else {
                nextBtn.innerText = 'NEXT CHAPTER â†’';
                nextBtn.classList.remove('accent-blue');
                nextBtn.classList.add('accent-orange');
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateUI();
            } else {
                currentPage = 1;
                updateUI();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateUI();
            }
        }

        async function handleExcelRequest() {
            const btn = document.getElementById('cta-btn');
            const name = document.getElementById('cta-name').value;
            const phone = document.getElementById('cta-phone').value;
            
            if(!name || !phone) {
                btn.innerHTML = "è«‹å¡«å¯«å§“ååŠé›»è©±ï¼";
                setTimeout(() => btn.innerHTML = "ç«‹åˆ»é ˜å–æ‡¶äººåŒ…", 2000);
                return;
            }

            btn.innerHTML = "è™•ç†ä¸­... / PROCESSING...";
            btn.disabled = true;
            
            try {
                // ğŸ›‘ è«‹æ›ä¸Šä½ çš„ Webhook URL
                const webhookUrl = 'https://hook.us1.make.com/ä½ çš„å°ˆå±¬ä»£ç¢¼'; 
                
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, phone: phone, source: 'IG_Tax_Map_Pro_Agent' })
                });

                btn.innerHTML = "æˆåŠŸï¼ç¨å¾Œå°‡é€é WhatsApp ç™¼é€æ‡¶äººåŒ…";
                btn.classList.replace('bg-accent-blue', 'bg-green-600');
            } catch (error) {
                console.error("Webhook Error:", error);
                btn.innerHTML = "ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦ / ERROR";
                btn.disabled = false;
                setTimeout(() => btn.innerHTML = "ç«‹åˆ»é ˜å–æ‡¶äººåŒ…", 3000);
            }
        }

        // å…¨æ–°ï¼šå°ˆæ¥­ç‰ˆç¨…å‹™è¨ˆç®—é‚è¼¯
        function calculateProTax() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const isMarried = document.getElementById('maritalStatus').value === 'married';
            const isSingleParent = document.getElementById('singleParent').value === '1';
            
            // 1. è¨ˆç®—ç¸½å…ç¨…é¡ (Allowances)
            let totalAllowance = isMarried ? 264000 : 132000; // åŸºæœ¬/å·²å©šäººå£«å…ç¨…é¡
            
            if (isSingleParent && !isMarried) {
                totalAllowance += 132000; // å–®è¦ªå…ç¨…é¡
            }

            const childCount = parseInt(document.getElementById('childCount').value) || 0;
            const newbornCount = parseInt(document.getElementById('newbornCount').value) || 0;
            totalAllowance += (childCount * 130000);
            totalAllowance += (newbornCount * 130000); // æ–°ç”Ÿå…’è©²å¹´åº¦é¡å¤– 130k

            const p60T = parseInt(document.getElementById('p60T').value) || 0;
            const p60N = parseInt(document.getElementById('p60N').value) || 0;
            const p55T = parseInt(document.getElementById('p55T').value) || 0;
            const p55N = parseInt(document.getElementById('p55N').value) || 0;
            
            totalAllowance += (p60T * 100000); // 50k åŸºæœ¬ + 50k é¡å¤–åŒä½
            totalAllowance += (p60N * 50000);
            totalAllowance += (p55T * 50000);  // 25k åŸºæœ¬ + 25k é¡å¤–åŒä½
            totalAllowance += (p55N * 25000);

            // 2. è¨ˆç®—ç¸½æ‰£é™¤é¡ (Deductions)
            // MPF æœ€é«˜ä¸Šé™é€šå¸¸å¡« 18000ï¼Œé€™è£¡å…è¨±ç”¨å®¶è‡ªè¨‚ä½†é˜²å‘†æ¥µç«¯æ•¸å­—
            const mpf = Math.min(parseFloat(document.getElementById('mpf').value) || 0, 18000); 
            const qdap = Math.min(parseFloat(document.getElementById('qdap').value) || 0, 60000);
            const vhis = parseFloat(document.getElementById('vhis').value) || 0; // å‡è¨­ç”¨å®¶å¡«å¯«çš„æ˜¯åˆè³‡æ ¼ç¸½ä¿è²» (æ¯åä¸Šé™8k)
            const housing = Math.min(parseFloat(document.getElementById('housing').value) || 0, 100000);
            const education = Math.min(parseFloat(document.getElementById('education').value) || 0, 100000);

            const totalDeductions = mpf + qdap + vhis + housing + education;

            // 3. æ‡‰èª²ç¨…å…¥æ¯å¯¦é¡ (Net Chargeable Income)
            let nci = income - totalAllowance - totalDeductions;
            if (nci < 0) nci = 0;

            // 4. ç´¯é€²ç¨…ç‡è¨ˆç®— (Progressive Rate)
            let progTax = 0;
            if (nci > 200000) {
                progTax = 16000 + (nci - 200000) * 0.17; // å‰ 200k ç¨…æ¬¾ç‚º 16000 (1k+3k+5k+7k)
            } else if (nci > 150000) {
                progTax = 9000 + (nci - 150000) * 0.14;
            } else if (nci > 100000) {
                progTax = 4000 + (nci - 100000) * 0.10;
            } else if (nci > 50000) {
                progTax = 1000 + (nci - 50000) * 0.06;
            } else if (nci > 0) {
                progTax = nci * 0.02;
            }

            // 5. æ¨™æº–ç¨…ç‡è¨ˆç®— (Standard Rate) - 2025/26 å¯¦è¡Œå…©ç´šåˆ¶
            const netIncome = Math.max(0, income - totalDeductions); // æ‰£é™¤é¡ï¼Œä½†ä¸æ¸›å…ç¨…é¡
            let stdTax = 0;
            if (netIncome <= 5000000) {
                stdTax = netIncome * 0.15;
            } else {
                stdTax = (5000000 * 0.15) + ((netIncome - 5000000) * 0.16); // é¦– 500 è¬ 15%ï¼Œé¤˜é¡ 16%
            }

            // 6. æ±ºå®šæ¡ç”¨ä½•ç¨®ç¨…ç‡ (å–è¼ƒä½è€…)
            let isStandardRate = stdTax < progTax;
            let finalTaxBeforeRelief = isStandardRate ? stdTax : progTax;

            // 7. æ‰£æ¸›ä¸€æ¬¡æ€§å¯¬æ¸› ($3,000)
            let finalTax = Math.max(0, finalTaxBeforeRelief - 3000);

            // 8. é¡¯ç¤ºçµæœ
            const resultBox = document.getElementById('result-box');
            resultBox.classList.remove('hidden', 'animate-pulse');
            void resultBox.offsetWidth; // Trigger reflow
            resultBox.classList.add('animate-pulse');

            document.getElementById('tax-result').innerText = `$${Math.round(finalTax).toLocaleString()}`;
            document.getElementById('total-allowance-val').innerText = `$${totalAllowance.toLocaleString()}`;
            document.getElementById('total-deduction-val').innerText = `$${totalDeductions.toLocaleString()}`;
            document.getElementById('nci-val').innerText = `$${Math.round(nci).toLocaleString()}`;
            
            const methodDisplay = document.getElementById('tax-method');
            if (isStandardRate) {
                methodDisplay.innerHTML = `âš ï¸ <span class="text-orange-400">é«˜è–ªäººå£«ï¼šå·²æ¡ç”¨ã€Œå…©ç´šåˆ¶æ¨™æº–ç¨…ç‡ã€è¨ˆç®—</span>`;
            } else {
                methodDisplay.innerHTML = `<span class="font-bold">æ¡ç”¨ç´¯é€²ç¨…ç‡è¨ˆç®—</span> <span class="italic text-[8px] bg-blue-800/50 px-1 rounded">å·²æ‰£æ¸› $3k å¯¬å…</span>`;
            }
        }
    </script>
</body>
</html>
