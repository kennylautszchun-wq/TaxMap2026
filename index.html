<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <!-- ç¢ºä¿æ‰‹æ©Ÿç‰ˆä¸æœƒè‡ªå‹•æ”¾å¤§ï¼Œä¸”é«˜åº¦å°é½Šè¦–çª— -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¨…å‹™åœ°åœ– - 2025/26 å¹´åº¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', "Microsoft JhengHei", sans-serif;
            background-color: #0a0a0a; 
            /* é˜²æ­¢å‡ºç¾ç³»çµ±æ»¾å‹•æ¢ */
            overflow: hidden;
            margin: 0;
            padding: 0;
            /* ä½¿ç”¨ dvh ç¢ºä¿å–ºæœ‰ç¶²å€åˆ—å˜…æ‰‹æ©Ÿç€è¦½å™¨éƒ½ä¿‚å…¨è¢å¹• */
            height: 100dvh; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #app {
            /* è®“ä¸»å®¹å™¨ä½”æ»¿è¢å¹•ï¼Œæœ€å¤§å¯¬åº¦ç¶­æŒ 500px ä»¥ä¿è­‰æ¯”ä¾‹ */
            width: 100%;
            height: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card-bg {
            background-color: #121212; 
            position: relative;
            overflow: hidden;
            /* è®“å¡ç‰‡å¡«æ»¿å®¹å™¨é«˜åº¦ */
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
        }

        /* å…§å®¹å€åŸŸè¨­å®šç‚ºå¯æ»¾å‹• */
        #content-area {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            z-index: 20; /* ç¢ºä¿å…§å®¹åœ¨è§¸æ§å€ä¹‹ä¸Š */
        }

        /* --- å·¦å³è§¸æ§ç¿»é å€åŸŸ --- */
        .nav-zone {
            position: absolute;
            top: 0;
            bottom: 0;
            z-index: 10;
            /* é»æ“Šæ™‚æœƒæœ‰å¾®å¼±çš„åç™½æ•ˆæœæç¤º */
            transition: background-color 0.2s;
            cursor: pointer;
        }
        .nav-zone:active {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .nav-left {
            left: 0;
            width: 25%; /* å·¦é‚Š 25% ä¿‚ä¸Šä¸€é  */
        }
        .nav-right {
            right: 0;
            width: 25%; /* å³é‚Š 25% ä¿‚ä¸‹ä¸€é  */
        }
        /* ä¸­é–“ 50% ç•™ç©ºï¼Œç•€ç”¨å®¶å¡«è¡¨åŒé»æ“ŠæŒ‰éˆ•ï¼Œå””æœƒè§¸ç™¼ç¿»é  */


        .map-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(to right, rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .accent-orange { color: #ff6b00; }
        .bg-accent-orange { background-color: #ff6b00; }
        .accent-blue { color: #3b82f6; }
        .bg-accent-blue { background-color: #3b82f6; }
        .text-gray-custom { color: #a1a1aa; }
        .border-gray-custom { border-color: #333; }
        input::placeholder { color: #4b5563; }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ff6b00'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
        .page-transition { transition: all 0.4s ease-in-out; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        @keyframes pulse-blue {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pin { animation: pulse-blue 2s infinite ease-in-out; }
        .new-badge {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            margin-left: 8px;
        }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body>

    <!-- Main Container -->
    <div id="app">
        
        <!-- é ‚éƒ¨å°èˆªæŒ‡ç¤º (ä¿ç•™ä½œè¦–è¦ºæç¤ºï¼Œä½†é»æ“Šäº¤ç”±é€æ˜åœ–å±¤è™•ç†) -->
        <div class="flex justify-between items-center px-4 py-3 bg-[#0a0a0a] z-30">
            <div id="prev-indicator" class="text-xs font-bold tracking-tighter text-gray-500 opacity-0 transition-opacity">â† TAP LEFT</div>
            <div id="next-indicator" class="text-xs font-bold tracking-tighter text-orange-500 animate-pulse">TAP RIGHT â†’</div>
        </div>

        <!-- Card Container -->
        <div class="card-bg text-white shadow-[0_0_50px_rgba(0,0,0,0.8)] border-t border-white/5 relative">
            
            <!-- Map Grid Effect -->
            <div id="grid-bg" class="map-grid"></div>

            <!-- Top Accent Bar (Progress) -->
            <div class="h-1.5 w-full bg-gray-800 flex relative z-10 shrink-0">
                <div id="progress-bar" class="h-full bg-accent-orange transition-all duration-500" style="width: 25%;"></div>
            </div>

            <!-- éš±å½¢è§¸æ§ç¿»é å€ (æ”¾å–º content-area ä¹‹å¾Œï¼Œç”¨ z-index æ§åˆ¶) -->
            <!-- åªæœ‰åœ¨ä¸é˜»ç¤™ä¸­é–“è¼¸å…¥æ¡†çš„æƒ…æ³ä¸‹æ‰èƒ½é»æ“Š -->
            <div class="nav-zone nav-left" onclick="prevPage()"></div>
            <div class="nav-zone nav-right" onclick="nextPage()"></div>

            <!-- Card Content (å¯æ»¾å‹•å€åŸŸ) -->
            <div id="content-area" class="p-6 md:p-10 flex flex-col justify-between">
                
                <div>
                    <!-- Page 01: Cover -->
                    <div id="page-01" class="block animate-fade-in">
                        <header class="mt-8 relative">
                            <p class="text-xs font-black italic accent-orange tracking-[0.5em] mb-4">2025/26 èª²ç¨…å¹´åº¦</p>
                            
                            <div class="relative inline-block">
                                <h1 class="text-6xl md:text-7xl font-black italic tracking-tighter leading-[0.8] uppercase relative z-10">
                                    TAX<br><span class="accent-orange">MAP.</span>
                                </h1>
                                <div class="absolute -right-8 top-0 animate-pin pointer-events-none">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 21C16 17 20 13.4183 20 9C20 4.58172 16.4183 1 12 1C7.58172 1 4 4.58172 4 9C4 13.4183 8 17 12 21Z" fill="#3b82f6" stroke="white" stroke-width="1.5"/>
                                        <circle cx="12" cy="9" r="3" fill="white"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <h2 class="text-3xl md:text-4xl font-black italic tracking-tighter mt-4 flex items-center gap-2">
                                ç¨…å‹™åœ°åœ–<span class="accent-orange">.</span>
                                <span class="new-badge">CURRENT</span>
                            </h2>

                            <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-blue-600/10 blur-[60px] rounded-full pointer-events-none"></div>
                            
                            <p class="mt-12 text-sm font-bold tracking-widest text-gray-custom uppercase border-l-2 border-orange-500 pl-4 leading-relaxed">
                                ç¾è¡Œå¹´åº¦å°èˆªï¼š<br>å…¨é¢æŒæ¡å…ç¨…é¡åŠæ‰£ç¨…æ”»ç•¥
                            </p>
                        </header>
                        
                        <div class="mt-20 flex justify-center opacity-50 pointer-events-none">
                             <!-- æŒ‡ç¤ºå‹•ç•« -->
                             <div class="flex gap-2 items-center text-[10px] font-black tracking-widest text-gray-400 uppercase">
                                 <svg class="animate-bounce" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                                 TAP RIGHT TO START
                             </div>
                        </div>
                    </div>

                    <!-- Page 02: Allowances -->
                    <div id="page-02" class="hidden text-left">
                        <header class="mb-6">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">02 / ALLOWANCES</p>
                            <h1 class="text-4xl md:text-5xl font-black italic tracking-tighter">å…ç¨…é¡åœ°åœ–<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-6 relative z-30 pointer-events-none"> <!-- é˜²æ­¢é˜»ç¤™èƒŒæ™¯ç¿»é  -->
                            <div>
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">ç¾è¡Œå…ç¨…é¡ä¸€è¦½</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">åŸºæœ¬å…ç¨…é¡</span>
                                        <span class="text-lg font-black">$132,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">å­å¥³å…ç¨…é¡</span>
                                        <span class="text-lg font-black">$130,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">çˆ¶æ¯åŒä½ (60+)</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6">
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">Deductions æ‰£é™¤é¡</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">å±…æ‰€è²¸æ¬¾ / ç§Ÿé‡‘æ‰£é™¤</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic text-gray-300">è‡ªé¡˜é†«ä¿ (VHIS)</span>
                                        <span class="text-lg font-black text-gray-300">$8,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic accent-orange">å¹´é‡‘ (QDAP) / TVC</span>
                                        <span class="text-lg font-black accent-orange">$60,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 03: PRO Calculator -->
                    <div id="page-03" class="hidden">
                        <header class="mb-4">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">03 / PRO ENGINE</p>
                            <h1 class="text-3xl md:text-4xl font-black italic tracking-tighter">å°ˆæ¥­ç¨…å‹™è¨ˆç®—æ©Ÿ<span class="accent-orange">.</span></h1>
                        </header>
                        
                        <!-- è¨ˆç®—æ©Ÿä¸»é«”ï¼šç¢ºä¿ z-index é«˜æ–¼è§¸æ§å€ï¼Œä»¤ä¸­é–“çš„æŒ‰éˆ•å’Œè¼¸å…¥æ¡†å¯ä»¥æ­£å¸¸ä½¿ç”¨ -->
                        <div class="space-y-3 pb-4 relative z-40 custom-scroll">
                            
                            <!-- 1. åŸºæœ¬è³‡æ–™ -->
                            <div class="p-3 bg-white/5 border border-gray-700 rounded-sm">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="col-span-2">
                                        <label class="text-[10px] font-bold text-gray-custom tracking-widest uppercase mb-1 block">Annual Income ç¸½å¹´å…¥æ¯</label>
                                        <input type="number" id="income" placeholder="ä¾‹å¦‚: 600000" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm text-lg font-black focus:border-orange-500 transition-colors outline-none text-white">
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">å©šå§»ç‹€æ³</label>
                                        <select id="maritalStatus" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="single">å–®èº«</option>
                                            <option value="married">å·²å©š</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">å–®è¦ªå…ç¨…é¡</label>
                                        <select id="singleParent" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="0">å¦</option>
                                            <option value="1">æ˜¯</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. å®¶åº­æˆå“¡å…ç¨…é¡ (æ‘ºç–Š) -->
                            <details class="group bg-white/5 border border-gray-800 rounded-sm">
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-[11px] accent-orange uppercase tracking-widest outline-none">
                                    â–¼ é€²éšå…ç¨…é¡ (å­å¥³/çˆ¶æ¯)
                                    <span class="text-[9px] text-gray-500 group-open:hidden">å±•é–‹</span>
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">å­å¥³ ($130k)</label>
                                            <input type="number" id="childCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">åˆç”Ÿå¬° (å¤–åŠ $130k)</label>
                                            <input type="number" id="newbornCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">çˆ¶æ¯60+ (åŒä½)</label>
                                            <input type="number" id="p60T" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">çˆ¶æ¯60+ (éåŒä½)</label>
                                            <input type="number" id="p60N" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- 3. æ‰£é™¤é¡ (æ‘ºç–Š) -->
                            <details class="group bg-white/5 border border-gray-800 rounded-sm" open>
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-[11px] accent-orange uppercase tracking-widest outline-none">
                                    â–¼ æ‰£ç¨…é …ç›® (ä¿éšª/æˆ¿å±‹)
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-2">
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">å¼·ç©é‡‘ MPF (ä¸Šé™18k)</label>
                                        <input type="number" id="mpf" value="18000" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">å»¶æœŸå¹´é‡‘/TVC</label>
                                        <input type="number" id="qdap" placeholder="Max 60k" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">è‡ªé¡˜é†«ä¿ VHIS</label>
                                        <input type="number" id="vhis" placeholder="Max 8k/äºº" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">ç§Ÿé‡‘/æŒ‰æ­åˆ©æ¯</label>
                                        <input type="number" id="housing" placeholder="Max 100k" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                </div>
                            </details>

                            <!-- è¨ˆç®—æŒ‰éˆ• -->
                            <button onclick="calculateProTax()" class="w-full bg-accent-orange py-3.5 mt-2 font-black italic text-lg hover:bg-orange-600 transition-all uppercase tracking-tighter shadow-lg shadow-orange-500/20 rounded-sm active:scale-95">è¨ˆç®—çµæœ</button>
                            
                            <!-- çµæœå±•ç¤º -->
                            <div id="result-box" class="mt-4 p-4 bg-gradient-to-br from-white/10 to-transparent border border-orange-500/40 rounded-sm hidden relative overflow-hidden">
                                <p class="text-[10px] font-bold text-gray-300 tracking-widest uppercase mb-1">Estimated Tax æ‡‰ç¹³ç¨…æ¬¾</p>
                                <p id="tax-result" class="text-4xl md:text-5xl font-black accent-orange italic drop-shadow-md">$0</p>
                                
                                <div class="mt-3 grid grid-cols-2 gap-2 border-t border-gray-700 pt-2">
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">ç¸½å…ç¨…é¡</p>
                                        <p id="total-allowance-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">ç¸½æ‰£é™¤é¡</p>
                                        <p id="total-deduction-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Gemini AI å€å¡Š -->
                            <div id="ai-tips-container" class="mt-3 hidden">
                                <button onclick="generateAITips()" id="ai-btn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 py-3 font-black italic text-sm hover:from-indigo-500 hover:to-purple-500 transition-all uppercase tracking-tighter shadow-lg shadow-purple-500/20 rounded-sm flex items-center justify-center gap-2 active:scale-95">
                                    âœ¨ é¡¯ç¤ºéš±è—æ…³ç¨…ä½
                                </button>
                                
                                <div id="ai-result-box" class="mt-2 p-3 bg-indigo-900/30 border border-indigo-500/30 rounded-sm hidden relative">
                                    <p class="text-[10px] font-bold text-indigo-400 tracking-widest uppercase mb-1 flex items-center gap-1">AI æ…³ç¨…åˆ†æ</p>
                                    <div id="ai-text" class="text-[11px] text-indigo-50 leading-relaxed font-medium"></div>
                                </div>
                            </div>
                            
                        </div>
                    </div>

                    <!-- Page 04: Call to Action -->
                    <div id="page-04" class="hidden">
                        <header class="mb-4">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">04 / THE DESTINATION</p>
                            <h1 class="text-4xl md:text-5xl font-black italic tracking-tighter leading-tight">é ˜å–æ‡¶äººåŒ…<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-5 relative z-40"> <!-- ç¢ºä¿è¡¨å–®å¯ä»¥é»æ“Š -->
                            <div class="bg-accent-blue/10 p-4 border-l-4 border-accent-blue rounded-sm">
                                <p class="text-sm font-bold italic text-white mb-1 underline decoration-blue-500 underline-offset-4">2025/26 æ‰£ç¨…æ‡¶äººåŒ…</p>
                                <p class="text-xs text-gray-300 leading-relaxed">
                                    æƒ³çŸ¥é“å¦‚ä½•å–„ç”¨å„é …æ‰£ç¨…é¡ï¼Ÿç•™ä¸‹ WhatsAppï¼Œç³»çµ±æœƒå³æ™‚ç™¼é€ã€Œ2025/26 æ‰£ç¨…æ‡¶äººåŒ…ã€çµ¦ä½ åƒè€ƒã€‚
                                </p>
                            </div>

                            <div class="space-y-3 mt-4">
                                <input type="text" id="cta-name" placeholder="ä½ çš„å§“å / Name" class="w-full bg-black/60 border border-gray-600 p-3.5 rounded-sm text-sm font-bold focus:border-blue-500 outline-none text-white transition-colors">
                                
                                <input type="tel" id="cta-phone" placeholder="WhatsApp è™Ÿç¢¼ (ä¾‹: 91234567)" class="w-full bg-black/60 border border-gray-600 p-3.5 rounded-sm text-sm font-bold focus:border-green-500 outline-none text-white transition-colors">
                                
                                <button onclick="handleExcelRequest()" id="cta-btn" class="w-full bg-accent-blue py-4 mt-2 font-black italic text-lg hover:bg-blue-600 transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] uppercase tracking-tighter flex items-center justify-center gap-3 rounded-sm active:scale-95">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                    ç«‹åˆ»é ˜å–æ‡¶äººåŒ…
                                </button>
                                
                                <p class="text-[9px] text-center text-gray-500 uppercase tracking-widest mt-2 italic leading-relaxed pointer-events-none">
                                    * åƒ…ç”¨æ–¼ç™¼é€æ‡¶äººåŒ…ã€‚<br>æœ¬å°ˆé å…§å®¹çµ•ä¸æ§‹æˆå°ˆæ¥­ç¨…å‹™å»ºè­°ã€‚
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Footer (å›ºå®šæ–¼åº•éƒ¨) -->
            <footer class="mt-auto border-t border-gray-custom flex justify-between items-center bg-black/40 px-6 py-3 shrink-0 pointer-events-none relative z-30">
                <div>
                    <p class="text-[9px] font-black tracking-[0.2em] italic uppercase">Tax Map</p>
                    <p class="text-[9px] font-bold text-gray-custom tracking-widest uppercase">By Klau</p>
                </div>
                <div class="text-2xl font-black italic text-gray-400" id="page-number">01</div>
            </footer>

        </div>
    </div>

    <script>
        let currentPage = 1;
        const totalPages = 4;
        
        // Gemini API é‡‘é‘°
        const apiKey = "";
        let latestTaxData = null; 

        function updateUI() {
            // éš±è—æ‰€æœ‰é é¢
            for (let i = 1; i <= totalPages; i++) {
                document.getElementById(`page-0${i}`).classList.add('hidden');
                document.getElementById(`page-0${i}`).classList.remove('animate-fade-in');
            }
            
            // é¡¯ç¤ºç•¶å‰é é¢ä¸¦åŠ å…¥æ·¡å…¥å‹•ç•«
            const activePage = document.getElementById(`page-0${currentPage}`);
            activePage.classList.remove('hidden');
            void activePage.offsetWidth; // Trigger reflow
            activePage.classList.add('animate-fade-in');
            
            document.getElementById('page-number').innerText = `0${currentPage}`;
            
            // æ›´æ–°é€²åº¦æ¢
            const progress = (currentPage / totalPages) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // æ›´æ–°é ‚éƒ¨æŒ‡ç¤ºæ–‡å­—
            const prevInd = document.getElementById('prev-indicator');
            const nextInd = document.getElementById('next-indicator');

            if (currentPage === 1) {
                prevInd.classList.add('opacity-0');
            } else {
                prevInd.classList.remove('opacity-0');
            }

            if (currentPage === totalPages) {
                nextInd.innerText = "DONE";
                nextInd.classList.remove('text-orange-500', 'animate-pulse');
                nextInd.classList.add('text-gray-600');
            } else {
                nextInd.innerText = "TAP RIGHT â†’";
                nextInd.classList.add('text-orange-500', 'animate-pulse');
                nextInd.classList.remove('text-gray-600');
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updateUI();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updateUI();
            }
        }

        // åŠè‡ªå‹• WhatsApp é‚è¼¯
        async function handleExcelRequest() {
            const btn = document.getElementById('cta-btn');
            const name = document.getElementById('cta-name').value;
            const phone = document.getElementById('cta-phone').value;
            
            if(!name || !phone) {
                btn.innerHTML = "è«‹å¡«å¯«å§“ååŠé›»è©±ï¼";
                setTimeout(() => btn.innerHTML = "ç«‹åˆ»é ˜å–æ‡¶äººåŒ…", 2000);
                return;
            }

            btn.innerHTML = "æ­£åœ¨é–‹å•Ÿ WhatsApp...";
            btn.disabled = true;
            
            // ğŸ›‘ è¨˜å¾—æ›è™Ÿç¢¼
            const yourWhatsAppNumber = "85291234567"; 
            const message = `Hi Klauï¼Œæˆ‘æ˜¯ ${name}ï¼Œæƒ³é ˜å– 2025/26 æ‰£ç¨…æ‡¶äººåŒ…ï¼æˆ‘çš„è¯çµ¡é›»è©±æ˜¯ ${phone}ã€‚`;
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${yourWhatsAppNumber}?text=${encodedMessage}`;
            
            setTimeout(() => {
                window.open(whatsappUrl, '_blank');
                btn.innerHTML = "å·²è½‰è·³è‡³ WhatsAppï¼";
                btn.classList.replace('bg-accent-blue', 'bg-green-600');
            }, 800);
        }

        // å°ˆæ¥­ç‰ˆè¨ˆç®—é‚è¼¯
        function calculateProTax() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const isMarried = document.getElementById('maritalStatus').value === 'married';
            const isSingleParent = document.getElementById('singleParent').value === '1';
            
            let totalAllowance = isMarried ? 264000 : 132000;
            if (isSingleParent && !isMarried) totalAllowance += 132000; 

            const childCount = parseInt(document.getElementById('childCount').value) || 0;
            const newbornCount = parseInt(document.getElementById('newbornCount').value) || 0;
            totalAllowance += (childCount * 130000) + (newbornCount * 130000); 

            const p60T = parseInt(document.getElementById('p60T').value) || 0;
            const p60N = parseInt(document.getElementById('p60N').value) || 0;
            const p55T = parseInt(document.getElementById('p55T').value) || 0;
            const p55N = parseInt(document.getElementById('p55N').value) || 0;
            
            totalAllowance += (p60T * 100000) + (p60N * 50000) + (p55T * 50000) + (p55N * 25000);

            const mpf = Math.min(parseFloat(document.getElementById('mpf').value) || 0, 18000); 
            const qdap = Math.min(parseFloat(document.getElementById('qdap').value) || 0, 60000);
            const vhis = parseFloat(document.getElementById('vhis').value) || 0; 
            const housing = Math.min(parseFloat(document.getElementById('housing').value) || 0, 100000);

            const totalDeductions = mpf + qdap + vhis + housing;

            let nci = income - totalAllowance - totalDeductions;
            if (nci < 0) nci = 0;

            let progTax = 0;
            if (nci > 200000) progTax = 16000 + (nci - 200000) * 0.17; 
            else if (nci > 150000) progTax = 9000 + (nci - 150000) * 0.14;
            else if (nci > 100000) progTax = 4000 + (nci - 100000) * 0.10;
            else if (nci > 50000) progTax = 1000 + (nci - 50000) * 0.06;
            else if (nci > 0) progTax = nci * 0.02;

            const netIncome = Math.max(0, income - totalDeductions); 
            let stdTax = netIncome <= 5000000 ? netIncome * 0.15 : (5000000 * 0.15) + ((netIncome - 5000000) * 0.16); 

            let finalTaxBeforeRelief = Math.min(stdTax, progTax);
            let finalTax = Math.max(0, finalTaxBeforeRelief - 3000);
            
            latestTaxData = { income, isMarried, qdap, vhis, housing, finalTax };

            const resultBox = document.getElementById('result-box');
            resultBox.classList.remove('hidden');
            
            // åŠ å…¥æ·¡å…¥å‹•ç•«
            resultBox.style.opacity = '0';
            setTimeout(() => {
                resultBox.style.transition = 'opacity 0.5s ease';
                resultBox.style.opacity = '1';
            }, 10);

            document.getElementById('tax-result').innerText = `$${Math.round(finalTax).toLocaleString()}`;
            document.getElementById('total-allowance-val').innerText = `$${totalAllowance.toLocaleString()}`;
            document.getElementById('total-deduction-val').innerText = `$${totalDeductions.toLocaleString()}`;
            
            // é¡¯ç¤º AI åˆ†ææŒ‰éˆ•
            document.getElementById('ai-tips-container').classList.remove('hidden');
            document.getElementById('ai-result-box').classList.add('hidden');
            document.getElementById('ai-btn').innerHTML = "âœ¨ é¡¯ç¤ºéš±è—æ…³ç¨…ä½";
            document.getElementById('ai-btn').disabled = false;
        }

        // Gemini AI åˆ†æ
        async function generateAITips() {
            if (!latestTaxData) return;
            
            const btn = document.getElementById('ai-btn');
            const resultBox = document.getElementById('ai-result-box');
            const textBox = document.getElementById('ai-text');
            
            btn.innerHTML = "âœ¨ åˆ†æä¸­... / ANALYZING...";
            btn.disabled = true;
            
            const promptText = `ä½ ä¿‚ä¸€å€‹é¦™æ¸¯å°ˆæ¥­ç†è²¡é¡§å•ã€‚å®¢æˆ¶å¹´è–ªï¼š$${latestTaxData.income}ï¼Œç›®å‰è¦äº¤ç¨…ï¼š$${latestTaxData.finalTax}ã€‚ä½¢ç›®å‰å¡«å˜…æ‰£ç¨…é¡ï¼šTVC/å¹´é‡‘ $${latestTaxData.qdap}, è‡ªé¡˜é†«ä¿ $${latestTaxData.vhis}ã€‚è«‹ç”¨ã€Œå»£æ±è©±å£èªã€å¯«ä¸€æ®µç´„ 80 å­—å˜…çŸ­è©•ï¼Œå¦‚æœæœªç”¨ç›¡ TVC ($60,000) æˆ– VHIS ($8,000) å°±æä¸‹ä½¢ã€‚çµå°¾è¬›ï¼šã€Œå¿«å•²å–ºä¸‹ä¸€é ç•™ä½ WhatsAppï¼Œç­‰æˆ‘ send å€‹æ‡¶äººåŒ…ç•€ä½ åƒè€ƒå•¦ï¼ã€å””å¥½ç”¨ markdown æ¨™é¡Œã€‚`;

            const payload = {
                contents: [{ parts: [{ text: promptText }] }],
                systemInstruction: { parts: [{ text: "You are a helpful Hong Kong financial advisor assistant." }] }
            };

            let retries = 0;
            const delays = [1000, 2000, 4000];
            let success = false;

            while (retries < 3 && !success) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) throw new Error('API Error');
                    
                    const data = await response.json();
                    textBox.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || "åˆ†ææœªèƒ½å®Œæˆï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
                    resultBox.classList.remove('hidden');
                    btn.innerHTML = "âœ¨ åˆ†æå®Œæˆ";
                    success = true;
                } catch (error) {
                    retries++;
                    if (retries >= 3) {
                        textBox.innerText = "ç³»çµ±ç¹å¿™ã€‚ä¸éå””ç·Šè¦ï¼Œä½ å¯ä»¥ç›´æ¥å»ä¸‹ä¸€é é ˜å–æ‡¶äººåŒ…äº†è§£æ›´å¤šï¼";
                        resultBox.classList.remove('hidden');
                        btn.innerHTML = "âœ¨ åˆ†ææœªèƒ½å®Œæˆ";
                    } else {
                        await new Promise(r => setTimeout(r, delays[retries-1]));
                    }
                }
            }
        }
    </script>
</body>
</html>
