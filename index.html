<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <!-- 確保手機版不會自動放大，且高度對齊視窗 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>稅務地圖 - 2025/26 年度</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', "Microsoft JhengHei", sans-serif;
            background-color: #0a0a0a; 
            /* 防止出現系統滾動條 */
            overflow: hidden;
            margin: 0;
            padding: 0;
            /* 使用 dvh 確保喺有網址列嘅手機瀏覽器都係全螢幕 */
            height: 100dvh; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #app {
            /* 讓主容器佔滿螢幕，最大寬度維持 500px 以保證比例 */
            width: 100%;
            height: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card-bg {
            background-color: #121212; 
            position: relative;
            overflow: hidden;
            /* 讓卡片填滿容器高度 */
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
        }

        /* 內容區域設定為可滾動 */
        #content-area {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            z-index: 20; /* 確保內容在觸控區之上 */
        }

        .map-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(to right, rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .accent-orange { color: #ff6b00; }
        .bg-accent-orange { background-color: #ff6b00; }
        .accent-blue { color: #3b82f6; }
        .bg-accent-blue { background-color: #3b82f6; }
        .text-gray-custom { color: #a1a1aa; }
        .border-gray-custom { border-color: #333; }
        input::placeholder { color: #4b5563; }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ff6b00'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
        .page-transition { transition: all 0.4s ease-in-out; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        @keyframes pulse-pin {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pin { animation: pulse-pin 2s infinite ease-in-out; }
        
        @keyframes swipe-hint {
            0% { transform: translateX(0); opacity: 0.5; }
            50% { transform: translateX(-10px); opacity: 1; }
            100% { transform: translateX(0); opacity: 0.5; }
        }
        .animate-swipe { animation: swipe-hint 1.5s infinite ease-in-out; }

        .new-badge {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            margin-left: 8px;
        }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body>

    <!-- Main Container -->
    <div id="app">

        <!-- Card Container -->
        <div class="card-bg text-white shadow-[0_0_50px_rgba(0,0,0,0.8)] border-t border-white/5 relative">
            
            <!-- Map Grid Effect -->
            <div id="grid-bg" class="map-grid"></div>

            <!-- Top Accent Bar (Progress) -->
            <div class="h-1.5 w-full bg-gray-800 flex relative z-10 shrink-0">
                <div id="progress-bar" class="h-full bg-accent-orange transition-all duration-500" style="width: 25%;"></div>
            </div>

            <!-- Card Content (可滾動區域) -->
            <div id="content-area" class="p-6 md:p-10 flex flex-col justify-between">
                
                <div class="h-full flex-grow flex flex-col justify-center">
                    <!-- Page 01: Cover -->
                    <div id="page-01" class="relative flex flex-col items-center justify-center animate-fade-in text-center h-full">
                        <header class="relative pointer-events-none flex flex-col items-center w-full">
                            <p class="text-sm md:text-base font-black italic accent-orange tracking-[0.5em] mb-6">2025/26 課稅年度</p>
                            
                            <div class="relative flex justify-center w-full">
                                <h1 class="font-black italic tracking-tighter uppercase relative z-10 flex flex-col text-left">
                                    <!-- TAX 喺左上方，疊喺上面 -->
                                    <span class="text-7xl md:text-8xl relative z-20 drop-shadow-xl">TAX</span>
                                    
                                    <!-- MAP 喺右下方 -->
                                    <span class="text-7xl md:text-8xl accent-orange relative z-10 -mt-6 md:-mt-8 ml-16 md:ml-24 pr-2 inline-block">
                                        <!-- 橙色 Pin 定位喺 MAP 嘅左邊，向下移動一點 -->
                                        <span class="absolute -left-10 md:-left-12 top-8 md:top-10 animate-pin pointer-events-none">
                                            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M12 21C16 17 20 13.4183 20 9C20 4.58172 16.4183 1 12 1C7.58172 1 4 4.58172 4 9C4 13.4183 8 17 12 21Z" fill="#ff6b00" stroke="white" stroke-width="2"/>
                                                <circle cx="12" cy="9" r="3" fill="white"/>
                                            </svg>
                                        </span>
                                        MAP
                                    </span>
                                </h1>
                            </div>
                            
                            <h2 class="text-4xl md:text-5xl font-black italic tracking-tighter mt-12 flex items-center justify-center">
                                稅務地圖<span class="accent-orange">.</span>
                            </h2>

                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 bg-blue-600/10 blur-[60px] rounded-full pointer-events-none"></div>
                            
                            <p class="mt-12 text-base md:text-lg font-bold tracking-widest text-gray-custom uppercase leading-relaxed text-center">
                                現行年度導航：<br>全面掌握免稅額及扣稅攻略
                            </p>
                        </header>
                        
                        <div class="absolute bottom-2 left-0 w-full flex justify-center opacity-50 pointer-events-none">
                             <!-- 滑動指示動畫 -->
                             <div class="flex gap-2 items-center text-xs md:text-sm font-black tracking-widest text-gray-custom uppercase">
                                 <svg class="animate-swipe" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 12H5m7 7l-7-7 7-7"></path></svg>
                                 SWIPE LEFT TO START
                             </div>
                        </div>
                    </div>

                    <!-- Page 02: Allowances -->
                    <div id="page-02" class="hidden text-left">
                        <header class="mb-6">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">02 / ALLOWANCES</p>
                            <h1 class="text-4xl md:text-5xl font-black italic tracking-tighter">免稅額地圖<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-6 relative z-30 pointer-events-none">
                            <div>
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">現行免稅額一覽</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">基本免稅額</span>
                                        <span class="text-lg font-black">$132,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">子女免稅額</span>
                                        <span class="text-lg font-black">$130,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">父母同住 (60+)</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6">
                                <p class="text-[10px] font-bold accent-orange tracking-widest uppercase mb-3 border-b border-orange-900/50 pb-1">Deductions 扣除額</p>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic">居所貸款 / 租金扣除</span>
                                        <span class="text-lg font-black">$100,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic text-gray-300">自願醫保 (VHIS)</span>
                                        <span class="text-lg font-black text-gray-300">$8,000</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-black italic accent-orange">年金 (QDAP) / TVC</span>
                                        <span class="text-lg font-black accent-orange">$60,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 03: PRO Calculator -->
                    <div id="page-03" class="hidden">
                        <header class="mb-4">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">03 / PRO ENGINE</p>
                            <h1 class="text-3xl md:text-4xl font-black italic tracking-tighter">專業稅務計算機<span class="accent-orange">.</span></h1>
                        </header>
                        
                        <div class="space-y-3 pb-4 relative z-40 custom-scroll">
                            <div class="p-3 bg-white/5 border border-gray-700 rounded-sm">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="col-span-2">
                                        <label class="text-[10px] font-bold text-gray-custom tracking-widest uppercase mb-1 block">Annual Income 總年入息</label>
                                        <input type="number" id="income" placeholder="例如: 600000" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm text-lg font-black focus:border-orange-500 transition-colors outline-none text-white">
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">婚姻狀況</label>
                                        <select id="maritalStatus" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="single">單身</option>
                                            <option value="married">已婚</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] font-bold text-gray-custom uppercase mb-1 block">單親免稅額</label>
                                        <select id="singleParent" class="w-full bg-black/60 border border-gray-600 p-2.5 rounded-sm font-bold text-xs focus:border-orange-500 outline-none text-white">
                                            <option value="0">否</option>
                                            <option value="1">是</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <details class="group bg-white/5 border border-gray-800 rounded-sm">
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-[11px] accent-orange uppercase tracking-widest outline-none">
                                    ▼ 進階免稅額 (子女/父母)
                                    <span class="text-[9px] text-gray-500 group-open:hidden">展開</span>
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">子女 ($130k)</label>
                                            <input type="number" id="childCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">初生嬰 (外加$130k)</label>
                                            <input type="number" id="newbornCount" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">父母60+ (同住)</label>
                                            <input type="number" id="p60T" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                        <div>
                                            <label class="text-[9px] font-bold text-gray-400 block mb-1">父母60+ (非同住)</label>
                                            <input type="number" id="p60N" value="0" min="0" class="w-full bg-black/40 border border-gray-700 p-2 rounded-sm font-bold text-sm outline-none">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <details class="group bg-white/5 border border-gray-800 rounded-sm" open>
                                <summary class="p-3 cursor-pointer flex justify-between items-center font-bold text-[11px] accent-orange uppercase tracking-widest outline-none">
                                    ▼ 扣稅項目 (保險/房屋)
                                </summary>
                                <div class="p-3 pt-0 border-t border-gray-800 mt-2 space-y-2">
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">強積金 MPF (上限18k)</label>
                                        <input type="number" id="mpf" value="18000" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">延期年金/TVC</label>
                                        <input type="number" id="qdap" placeholder="Max 60k" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">自願醫保 VHIS</label>
                                        <input type="number" id="vhis" placeholder="Max 8k/人" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <label class="text-[10px] font-bold text-gray-custom uppercase">租金/按揭利息</label>
                                        <input type="number" id="housing" placeholder="Max 100k" class="w-24 bg-black/60 border border-gray-700 p-1.5 rounded-sm text-right font-bold focus:border-orange-500 outline-none">
                                    </div>
                                </div>
                            </details>

                            <button onclick="calculateProTax()" class="w-full bg-accent-orange py-3.5 mt-2 font-black italic text-lg hover:bg-orange-600 transition-all uppercase tracking-tighter shadow-lg shadow-orange-500/20 rounded-sm active:scale-95">計算結果</button>
                            
                            <div id="result-box" class="mt-4 p-4 bg-gradient-to-br from-white/10 to-transparent border border-orange-500/40 rounded-sm hidden relative overflow-hidden">
                                <p class="text-[10px] font-bold text-gray-300 tracking-widest uppercase mb-1">Estimated Tax 應繳稅款</p>
                                <p id="tax-result" class="text-4xl md:text-5xl font-black accent-orange italic drop-shadow-md">$0</p>
                                
                                <div class="mt-3 grid grid-cols-2 gap-2 border-t border-gray-700 pt-2">
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">總免稅額</p>
                                        <p id="total-allowance-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                    <div>
                                        <p class="text-[9px] font-bold text-gray-500 uppercase">總扣除額</p>
                                        <p id="total-deduction-val" class="text-sm font-black text-gray-200">$0</p>
                                    </div>
                                </div>
                            </div>

                            <div id="ai-tips-container" class="mt-3 hidden">
                                <button onclick="generateAITips()" id="ai-btn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 py-3 font-black italic text-sm hover:from-indigo-500 hover:to-purple-500 transition-all uppercase tracking-tighter shadow-lg shadow-purple-500/20 rounded-sm flex items-center justify-center gap-2 active:scale-95">
                                    ✨ 顯示隱藏慳稅位
                                </button>
                                
                                <div id="ai-result-box" class="mt-2 p-3 bg-indigo-900/30 border border-indigo-500/30 rounded-sm hidden relative">
                                    <p class="text-[10px] font-bold text-indigo-400 tracking-widest uppercase mb-1 flex items-center gap-1">AI 慳稅分析</p>
                                    <div id="ai-text" class="text-[11px] text-indigo-50 leading-relaxed font-medium"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 04: Call to Action -->
                    <div id="page-04" class="hidden">
                        <header class="mb-4">
                            <p class="text-[10px] font-black italic accent-orange tracking-[0.3em] mb-1">04 / THE DESTINATION</p>
                            <h1 class="text-4xl md:text-5xl font-black italic tracking-tighter leading-tight">領取懶人包<span class="accent-orange">.</span></h1>
                        </header>

                        <div class="space-y-5 relative z-40">
                            <div class="bg-accent-blue/10 p-4 border-l-4 border-accent-blue rounded-sm">
                                <p class="text-sm font-bold italic text-white mb-1 underline decoration-blue-500 underline-offset-4">2025/26 扣稅懶人包</p>
                                <p class="text-xs text-gray-300 leading-relaxed">
                                    想知道如何善用各項扣稅額？留下 WhatsApp，系統會即時發送「2025/26 扣稅懶人包」給你參考。
                                </p>
                            </div>

                            <div class="space-y-3 mt-4">
                                <input type="text" id="cta-name" placeholder="你的姓名 / Name" class="w-full bg-black/60 border border-gray-600 p-3.5 rounded-sm text-sm font-bold focus:border-blue-500 outline-none text-white transition-colors">
                                <input type="tel" id="cta-phone" placeholder="WhatsApp 號碼 (例: 91234567)" class="w-full bg-black/60 border border-gray-600 p-3.5 rounded-sm text-sm font-bold focus:border-green-500 outline-none text-white transition-colors">
                                <button onclick="handleExcelRequest()" id="cta-btn" class="w-full bg-accent-blue py-4 mt-2 font-black italic text-lg hover:bg-blue-600 transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] uppercase tracking-tighter flex items-center justify-center gap-3 rounded-sm active:scale-95">
                                    立刻領取懶人包
                                </button>
                                <p class="text-[9px] text-center text-gray-500 uppercase tracking-widest mt-2 italic leading-relaxed pointer-events-none">
                                    * 僅用於發送懶人包。<br>本專頁內容絕不構成專業稅務建議。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="mt-auto border-t border-gray-custom flex justify-between items-center bg-black/40 px-6 py-3 shrink-0 pointer-events-none relative z-30">
                <div>
                    <p class="text-[9px] font-black tracking-[0.2em] italic uppercase">Tax Map</p>
                    <p class="text-[9px] font-bold text-gray-custom tracking-widest uppercase">By Klau</p>
                </div>
                <div class="text-2xl font-black italic text-gray-400" id="page-number">01</div>
            </footer>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const totalPages = 4;
        const apiKey = "";
        let latestTaxData = null; 

        function updateUI() {
            for (let i = 1; i <= totalPages; i++) {
                document.getElementById(`page-0${i}`).classList.add('hidden');
                document.getElementById(`page-0${i}`).classList.remove('animate-fade-in');
            }
            const activePage = document.getElementById(`page-0${currentPage}`);
            activePage.classList.remove('hidden');
            void activePage.offsetWidth;
            activePage.classList.add('animate-fade-in');
            document.getElementById('page-number').innerText = `0${currentPage}`;
            const progress = (currentPage / totalPages) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function nextPage() { if (currentPage < totalPages) { currentPage++; updateUI(); } }
        function prevPage() { if (currentPage > 1) { currentPage--; updateUI(); } }

        async function handleExcelRequest() {
            const btn = document.getElementById('cta-btn');
            const name = document.getElementById('cta-name').value;
            const phone = document.getElementById('cta-phone').value;
            if(!name || !phone) { btn.innerHTML = "請填寫姓名及電話！"; return; }
            btn.innerHTML = "正在開啟 WhatsApp...";
            const yourWhatsAppNumber = "85291234567"; 
            const message = `Hi Klau，我是 ${name}，想領取 2025/26 扣稅懶人包！我的聯絡電話是 ${phone}。`;
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${yourWhatsAppNumber}?text=${encodedMessage}`;
            setTimeout(() => { window.open(whatsappUrl, '_blank'); btn.innerHTML = "已轉跳！"; }, 800);
        }

        function calculateProTax() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const isMarried = document.getElementById('maritalStatus').value === 'married';
            const isSingleParent = document.getElementById('singleParent').value === '1';
            let totalAllowance = isMarried ? 264000 : 132000;
            if (isSingleParent && !isMarried) totalAllowance += 132000; 
            totalAllowance += (parseInt(document.getElementById('childCount').value) || 0) * 130000;
            totalAllowance += (parseInt(document.getElementById('newbornCount').value) || 0) * 130000;
            totalAllowance += (parseInt(document.getElementById('p60T').value) || 0) * 100000;
            totalAllowance += (parseInt(document.getElementById('p60N').value) || 0) * 50000;
            const mpf = Math.min(parseFloat(document.getElementById('mpf').value) || 0, 18000);
            const qdap = Math.min(parseFloat(document.getElementById('qdap').value) || 0, 60000);
            const vhis = parseFloat(document.getElementById('vhis').value) || 0;
            const housing = Math.min(parseFloat(document.getElementById('housing').value) || 0, 100000);
            const totalDeductions = mpf + qdap + vhis + housing;
            let nci = Math.max(0, income - totalAllowance - totalDeductions);
            let progTax = 0;
            if (nci > 200000) progTax = 16000 + (nci - 200000) * 0.17;
            else if (nci > 150000) progTax = 9000 + (nci - 150000) * 0.14;
            else if (nci > 100000) progTax = 4000 + (nci - 100000) * 0.10;
            else if (nci > 50000) progTax = 1000 + (nci - 50000) * 0.06;
            else if (nci > 0) progTax = nci * 0.02;
            const netIncome = Math.max(0, income - totalDeductions);
            let stdTax = netIncome <= 5000000 ? netIncome * 0.15 : 750000 + (netIncome - 5000000) * 0.16;
            let finalTax = Math.max(0, Math.min(stdTax, progTax) - 3000);
            latestTaxData = { income, isMarried, qdap, vhis, housing, finalTax };
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('tax-result').innerText = `$${Math.round(finalTax).toLocaleString()}`;
            document.getElementById('total-allowance-val').innerText = `$${totalAllowance.toLocaleString()}`;
            document.getElementById('total-deduction-val').innerText = `$${totalDeductions.toLocaleString()}`;
            document.getElementById('ai-tips-container').classList.remove('hidden');
        }

        async function generateAITips() {
            if (!latestTaxData) return;
            const btn = document.getElementById('ai-btn');
            const resultBox = document.getElementById('ai-result-box');
            const textBox = document.getElementById('ai-text');
            btn.innerHTML = "✨ 分析中...";
            const promptText = `你係理財顧問。年薪$${latestTaxData.income}，稅款$${latestTaxData.finalTax}。QDAP填$${latestTaxData.qdap}，VHIS填$${latestTaxData.vhis}。用廣東話寫約80字評語。結尾叫佢下一頁攞懶人包。`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
                });
                const data = await response.json();
                textBox.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || "暫時未能分析。";
                resultBox.classList.remove('hidden');
                btn.innerHTML = "✨ 分析完成";
            } catch { btn.innerHTML = "✨ 系統繁忙"; }
        }

        let touchStartX = 0;
        let touchEndX = 0;
        const appElement = document.getElementById('app');
        appElement.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX, { passive: true });
        appElement.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); }, { passive: true });
        
        function handleSwipe() {
            const diffX = touchEndX - touchStartX;
            if (Math.abs(diffX) > 50) {
                if (diffX > 0) prevPage();
                else nextPage();
            }
        }
    </script>
</body>
</html>
